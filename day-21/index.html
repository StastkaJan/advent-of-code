<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="light dark">

  <title>Day 21 - Advent of code</title>
</head>

<body>
  <pre
    style="word-wrap: break-word; white-space: pre-wrap;">...................................................................................................................................
..##.#..#.....#.##......#........##.....#..#....##..................................#..#....................#.......#.##.#.......#.
..............#....#...#...##.....#...........#.#........................#.................#......#...........##.#.#............#..
.......#...#..........#.#....#..........##.........#.#........................#...............#....#..#.#...........#...##...#.....
.....#....#..#..#...........#..................#.............................#.........#.#........#...#...#..............#.........
...#......#......##.#....................#..#..#......#...........#................#....#......##...#...........#.....#.#......##..
...#...#..##......#..........#..#...........#.#......#.....................##..#.#.......................#.##........##.........#..
........#...#.....#....##......#...........#.#...#..#..................................#......#..##.#.........#.......#............
..#.###....##...#......#...........#......#........#.#.........#...#.#..............#..#.........#.........#.......##..#...........
.#...............##...#........#......##.........#..................#..............#....#........#........#...#.............#......
.....#.........#.......##......#.........##..#..............#......................#..#....#........###.##.#..................##...
.#..............#.#.#.#...............#....................#..#....##.#.........##....#................#........#......#.....#.....
........#..#..###...........#......#.#......#..............#...#.........#.......#....#........#..##............#....#......##.....
...#...#....#......#....#...................#.#............##........#..........................#......##.........#..#..#..........
.##...#............##..#.#.........##.....#..##.........................#............#.....#...#........#..#.......#.....#.........
..........####..#.....#....###...#.....##.....#..............#.#.............................##..#...##.##..#...#.........#........
............#....#...#........#........#....#..................##..#.##.................#........#....#..#........#.#.#...#..#.##..
...#.....#.....#..........#....#.#......#................#..###.#.#.#..##.................#...#.......##.#....#....#......#..#...#.
.#..###.#............................#.#............#.....#.......#...#.....#..#.........#........#........#..........###.....#....
.#...###.#.....#.........#..............................#................#...##.................#..#..#.....#.##....##.#...........
.....#.##...#.............#........#................#.#..................#.#.#.#.........##...........##.........##.......##....#..
.........#.#........####.#.##.....#....##.......#.......###.#.............#.................#.....#..###.#...............##......#.
.....#............#..#...#.##....#.............#...#...#..##.......#..............#........#...##...#...............##.......#.#...
..###...#..#..#.#........#.........#..........#.##.#..............#.#.#.........#.##..........#.#.......................#..........
.........#.......#......#.#..#...#...................#....#........#..............#............#..##.........#..#..#..#............
..#......#..##......##.#.##.###..#.#............#..#.........#............#.#......#..............#...#.##.....##.#.....#..........
..#......#..#.#....##...#.....##..............#...........#........###...##.....#.................##..#.....#.#......##.#...#......
..............#......##..##.......#.........##..#..#...............#....#..............................#......#.#.##.......#..#..#.
......#...............#.#......#..........##..#.....#..##...#........#..#.#..##....#...................##.##...#..........####..#..
.........#..#.......#...........#...........#.##..................#.............#.#...................#..........#.....#.........#.
.......#.......#..#.#.#.#..#.............##..#..........#.#...........#.........##..................#.......#.......##.........#...
.#.....................##....#........#....#.....#....#........##..#.....#....#.......#...#..............#.................#.#..#..
.#..........#...#...#........#.........##.....#.#..#....#...####......#....#...............#....................................#..
..#.#..#...#..#.............#.......##..#........#...#....#....#...##.#..........##.....#...##........#...##.....#....#..#...#.#...
...#...................#................#.............#.............#.......................##.........#................#...#......
.............##....##.....................##.....#..#..#.####......##..#............#...#..................#.##.#.#..#...##.##.....
..#......#......#......#................#.#......##........#.#..................#.............#..#........#...........#.....##.....
.......#..##....................#...#.#................#.................#.#.#..#...#.......#...................................#..
.....#..#..#..#....#...........#.......##...........................#.#......#.......#......#....................##.#......#.......
............##......##...................##.......#.........#.#......#...#..........#..##.......#..#............#.........###....#.
..............................#.##........#.#.............#....#.......................#...#..#.....#.................#...#.....##.
..##....#....#.#....................#........................#.#.....#...#.##..#.....#......#.#..................#.................
.##...#....##......#..........##......#...#......#....#............#...#.#.....#..............#........#............##........#..#.
.##..............#................#..................#...#......#.....#..##........#............#....#.............#.#..####.......
......#......#.#...........#..#.........#.....#....#....#.....#....#.............#.......#...#.#....#...................#....#.....
.#....#..#..............#...##.....#.........#..#.........................#..#.........#.................##........##..........##..
.............#.#................##.#......#.....................#.#..........#.#..##.....#.##.#.#.##.#....#................#.....#.
.......#....................#.##...................###....#...........#............#......#...........#....#..................#....
...##..#...............##...#.........#.#..........##...#.....##..#......#...#.#..#.......#.......#.......................#..#...#.
......#..#...........###.........#.#...#..........#.....#...#.##..#..........#.........#..............#...................#........
....#...#..#.............#...............................#...##...#......#..#....#.#............#........##.#..........###.........
........#........................#.#.#..............#...............#....#...#.....#..#.#....................#.............#...#...
..#...............#..##.....##..........#....#.###................#....#.#..#.#........##.##............#...#.#..............#.....
.##................#.......#.............#..##........................#......##...#......#.#..........#.#.#..#..............#..#...
...............##..###.#......##.#......#...............#...#.##........#...#.#...#.......#..###........#.#...#............#...#...
..##.#.............#.........#..........##.......#....#...#.#.#...#......#.....#...#.#.........#....#......##.#...............#.#..
.#...........#.........#..#.#...##.......#.............#..........#...##...#...#...#.....#........##...#......#.#....#.............
.#................#...............#............##..#..#....##............#........#....#..#......#.....#......#.##...#.........#.#.
.#.........##...#.#.##...........#..........#...#.......#...#..........#...............#.......#.......#.#.##....#..#...........#..
..#...........##..#.....#.......#...................#..............#...#.#...##.#.......#.#......#................#..#..........#..
............#............#.....#.#.#........##.......#..#..#.........#......#.............##..##......#......#..#.#................
........##...........#......##.......#.....#...................#...#.........#.###..........####..##.....#....#........#...........
.........#.......#.#..........................#.#.............#......#..#.....#......#..........#.............#.....#..............
........#...#...#........#..#................#..#...#.......#......##.#...#.#........#............#.....#.#........#...............
.......................#...........#...#.#.......#.........#...##......#...#..#.......................#..#......#..........#.......
.................................................................S.................................................................
..........#...........#......#............................#..##.....#...#.#.#...........#..........##.......#.........#..##.#......
.......#.....#.........##.#........#.....#....#..#.....#...#...#.......##..#.......##..#.........#..##.................#...........
................................##...................#.......#.......##..............#...................##......#.................
.............#........#......##.....#...#...#..........##.......#.#........#.........#.......#....##...........#......#...#........
..............#................#...#....#....#..............#.........#....#...................#..........#...........#............
..................#...#.#..#.#...............##.....#.....#..##.......#.#...##....#.........##.............#.......................
............#......###.#...#...#......#....##........#..#####.#.#......#.#.#...#.#......#........#...#..#.#.#.#......#..........#..
....#.................##........#..#..#..........##.###...#...#.#.....##.................#...#.......#.#.............#.............
.#...........#..#..#...#.#..........#.#.#.###............#...........#..#.................#.....#.....#..#.........................
...#.................##..#.#....#.......###..#.#.............#.....#....#.#.#............#.......##.....#.#..#......#........#.....
......#.................#.........#...#..............#.#.###..#......#...#.##..............#....##......#....#...#.............#...
........#..............#.#.......#.#.#...........#........................##..#....#..#...#..#.#...........#....#.#...........#....
..#.#.............#...............#........#.........#................##.........#....#...#.....##.......#................#..#.#.#.
.#..#................#...#..#...........#..#.....#..........#.....#..#...#.###....###.....##..##.........#...#.....................
....#...#...........#.....................#..#...........##........#.......#.#.....##.......#..###...#.........................#.#.
....#.##.#.............##.....#.......#.#......#.##..........###..##.##...............#...##....#...#...................##.........
....#...................#....#.#.#.......#...........#......#........#.#.#..#.....#.#.....#.##..##.#.....#..#........##..#..#.#.#..
..........#................#..#.#.....#.#....#........#....##.#..................#.................#.....#...............#...#.....
.........#...#.................................#.....#..#...........##...#.........#..#....#..#....#......#..........##....#...#...
...........#...#...........#.......#......#..............#........##.....#.......................##................#...........##..
..###......#..#.............##.##..#.#..##.......###..###...#..#...##.#...#.................#..........#............#..............
..#........##..#..........#.#......#..#..#...##.........#.#.................#.........#......#.#.................#........##...#...
..........#.................#..#..............#...........#.....#....#............##...#......#...................#........#.#.....
...........#.......##.........#.#..#...##...........#.....#...........#..............##.....#..##..................#..#.##..#......
..#.............#...#...............................#...........#...............#....................................##.....#......
...#......#........#...............#..#...#.......#.....###..#..#.#.#................#.#..........#.........................#..#...
...#................................#..#.....#......#..###.#........###...............#..........#.........#.....#.##....##........
.................#..#...........#...#.................#..#..#..#.......#..........#.........................#......#........#......
...#.#...#..#..#..#......#.......#.....#.......##.....##.....#.....#.....#.....#...............#...........................#.....#.
.#....#....##..#..#.##...#...........#.#.....#....#..................#..##....#.#..........##....................###......##.......
..#..#.#..............#............#..............##..............#..............#...............................#...........##.#..
.#.....#.#.#.#..##.#.#..................#........##.#...............#....#..#.....#..###..............................#...##.#.....
..#......#.........##....................##..##.......#.....#..............................#...............#....#.........#........
.....#.#.........#....##....##...............#.#.......#..........#......#..#..........#....#..........##.#.#.............#.....##.
..#.#.....#.........#.....#.#............#......#....#.....#...........#...............................#.....#.#...........#.....#.
......#......#....#...#....#............#.#....#............#..............#....#.........#.......#...#.#.......#.#.#........#.....
.........#..#........##...................#..#...#.#.....##.............#....#......#....................#.##....##....#...........
..#......#...........#.#...................#......#.#..##..#...#.......#.#......#.......#.........#....#.........#.#...#.##.#.#.#..
.......#......#..##.#........#.##.................#.#..#.#...#..........#......................#....#....#.........#......#........
.#.#......#................#...#....#.........#.....................##..##..........##............#.#.........#.......#......#...#.
...#..#.#..##...#............##...............#..##..........#..........##.#...##....#........#.........##.#...#....#.........#....
...#....#........#.........#.....##...#...........#.###.............#............#.#..............#..#.........#.....#...#....#....
...........#.................##.##....#.................#..........##....#.....#...........................#...#....#.......#......
..#......#...#...................................#.###.##......#.....#..##................#..#.......#....##....###......#...#.....
....#......#.....#.#..#..........#.....#.........#.....#..#..........#......#.#.............#..##.####.#.##.......#.......###..#...
...........#..#...#.##.................##.............#....##...#.#......#...............#.....##...#......#..#....................
............###.......#.#..#............#..#............#............#...#..##....................###....##..........#.#.#....#....
.#..#......#..#........................................#..#..#.....#.#...#.............##...........#..#...#......#....#.......#.#.
..............#..........#..............#...##..........###.#...#...##...............#...#.........#.#........###.........##..#....
........#..............##..............##....................#......#......#...........##..##.....#......#.....#.........##....#.#.
....#.#............#............#........#....#........#....#............#.................#...#.......#..#....#...#.......##....#.
........#......#.##....#.#..#.....#...#.........#.......#...........#..................##..##...###..#.##.....#....................
.......#.#....#...#..#......#...........#.#..#...#.......#...#.##..#..................#...#....#.......#.#..............#......#...
...#..#..#..............#....#.#....#..#......#..#.............#...#..#..........#.......................#..#.....#.....#........#.
......#.#.....#.......#..#..............#......................#......................#.....#.....##.......#.##..#.................
..#........#..#................#...........#....#............##...###............................#..#.......#..#...................
..#..##..#.##.....#...........##....###...#.#..#..................#.............#.....#..........#...........#...#...###...........
.....#....#.....#.......#...#......##..............#...............##.......#....#.....#.......#....#.#........#.....#..#.....#....
...............##.#.........##...#....##.#.#......................................##..#..##...#.##.......##.................##.....
...................#.....#..........#......#.#.#.#............................##....#.##..#.#..............#...##.....#..#..#......
.#...#...#.....#.........#..............#..........##.......................#..#..#........##..#.............##...#.........#......
.#..#...#....##.......##...........#.##........##..##...................#...#..#...#.....#.#...#........####.#...#........#..#.#...
....#.......##..#....##....#.....#..#..#.#..#.#..........#...............##.#..###...#..........#...#....#...#................##...
......#..#......#.#.....##....#.............#.##........................#.##.#...#...#....##.......##.#..................#..#..#...
...................................................................................................................................</pre>

  <script>
    const parseInput = () => {
      return document.querySelector('pre').innerText.split('\n').map(val => val.split(''))
    }
    data = parseInput()

    const solveSteps = (input, steps) => {
      let fieldCount = 0

      for (let i = 1; i <= steps; i++) {
        let nullsToSet = []

        for (let j = 0; j < input.length; j++) {
          for (let k = 0; k < input[j].length; k++) {
            if ((i === 1 && input[j][k] === 'S') || input[j][k] === 'O') {
              j > 0 && (input[j - 1][k] !== '#') && nullsToSet.push([j - 1, k])
              k > 0 && (input[j][k - 1] !== '#') && nullsToSet.push([j, k - 1])
              j < input.length - 1 && (input[j + 1][k] !== '#') && nullsToSet.push([j + 1, k])
              k < input[j].length - 1 && (input[j][k + 1] !== '#') && nullsToSet.push([j, k + 1])
              input[j][k] !== 'S' && (input[j][k] = '.')
            }
          }
        }

        for (let j = 0; j < nullsToSet.length; j++) {
          input[nullsToSet[j][0]][nullsToSet[j][1]] = 'O'
        }
      }


      for (let i = 0; i < input.length; i++) {
        for (let j = 0; j < input[i].length; j++) {
          if (input[i][j] === 'O') {
            fieldCount++
          }
        }
      }

      return fieldCount
    }

    const partOne = (input) => {
      const t1 = performance.now()
      let sum = 0

      sum = solveSteps(JSON.parse(JSON.stringify(input)), 64)

      console.log('Time for solution one is ' + (performance.now() - t1).toFixed(2) + ' ms')
      console.log('Solution for part one is ' + sum + '!')
    }
    partOne(data)

    const key = (i, j) => {
      return `${i},${j}`
    }

    const parse = (input) => {
      const grid = input
      const walls = {}
      const plots = {}
      let start = { i: 0, j: 0 }

      for (let i = 0; i < grid.length; i++) {
        for (let j = 0; j < grid[i].length; j++) {
          const value = grid[i][j]

          if (value == "#") {
            walls[key(i, j)] = true
          }

          if (value == "S") {
            plots[key(i, j)] = -1
            start = { i: i, j: j }
          }
        }
      }

      return {
        walls: walls,
        plots: plots,
        start: start,
        size: grid.length
      }
    }

    const wrapped = (i, j, size) => {
      i %= size
      j %= size

      return {
        wi: i >= 0 ? i : size + i,
        wj: j >= 0 ? j : size + j
      }
    }

    const getNextSteps = (grid, i, j, remaining) => {
      const k = key(i, j)
      const { wi, wj } = wrapped(i, j, grid.size)
      const wk = key(wi, wj)

      if (grid.walls[wk] || grid.plots[k] >= remaining) {
        return []
      }

      grid.plots[k] = remaining

      if (remaining > 0) {
        return [
          { i: i + 1, j: j, remaining: remaining - 1 },
          { i: i - 1, j: j, remaining: remaining - 1 },
          { i: i, j: j + 1, remaining: remaining - 1 },
          { i: i, j: j - 1, remaining: remaining - 1 }
        ]
      }
      return []
    }

    const simplifiedLagrange = (values) => {
      return {
        a: values[0] / 2 - values[1] + values[2] / 2,
        b: -3 * (values[0] / 2) + 2 * values[1] - values[2] / 2,
        c: values[0]
      }
    }

    const solveStepsTwo = (input, steps = 64) => {
      const grid = parse(input)
      const queue = [
        {
          i: grid.start.i,
          j: grid.start.j,
          remaining: steps
        }
      ]

      while (queue.length > 0) {
        const step = queue.shift()
        queue.push(...getNextSteps(grid, step.i, step.j, step.remaining))
      }

      return Object.values(grid.plots).filter((e) => e % 2 == 0).length;
    };

    const partTwo = (input) => {
      const t1 = performance.now()
      let sum = 0

      const values = [
        solveStepsTwo(input, 65),
        solveStepsTwo(input, 65 + 131),
        solveStepsTwo(input, 65 + 131 * 2)
      ]
      const poly = simplifiedLagrange(values)
      const target = (26_501_365 - 65) / 131

      sum = poly.a * target * target + poly.b * target + poly.c

      console.log('Time for solution two is ' + (performance.now() - t1).toFixed(2) + ' ms')
      console.log('Solution for part two is ' + sum + '!')
    }
    partTwo(data)
  </script>
</body>

</html>