<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="light dark">

  <title>Day 16 - Advent of code</title>
</head>

<body>
  <pre style="word-wrap: break-word; white-space: pre-wrap;">\....../...|..........|....../.../..-../.|...|......-.|..................................|.............../....
|....-.........\..........\......./.....................................|.....-...........||..................
.........-......|./...........\.../-......./.|...\.-.......................\....\.............................
...............//...............\.........................\.......................\....../........./.........\
..-........................-..........................................|............../..\.........../.........
..........\....\../...............|--....../..............-.............|...-.....\........\.........-...\-...
....|...|..|........................../..................-............./..\-........../|.........|...........|
.........-.....\...................-.............|.............../....-....-....|............../....\../-.....
.....\../\......../..|........................|.......-........................../-...|.......................
..............|/................|........|..-......|....|.|.......|.-....\.../.............|.....-.......-....
.-...|..................../..|......\......|./..-.....\../......................\.|..--...................../.
.............../..|...................-........./.................../....|.............-..........|.|..\../...
.|...........|-.........|/....\.....\...-...-.-.-......-...................................../.......\-.......
./................./.................\..................../.-..................|.....................\.....\..
\........-...|......|........-...................\.........................-..-........./....../.....\........
........-../..........|........................-..-/\...\........-.../.../...-......................./\.....-.
..//|\.........../\.......-...........\....\.....-./.|.............\...../..\.......||.......-................
........./....\.........\-................/................................|-...\/.........|......|...........
...|........\.../......\....../......\........./....|....../...../..|......../.-.........................\....
../......./....|................................................................................\\.......\..|.
.............-.\.|..........|....................................................-..........|.................
\......|.............\..-.....................................-.|...................................-|........
.....................-......|\......................|...-.\......-.........-.........\............//...-......
.../.....\..................|..-/....|.......\......\........./......./../............................\../....
....|....../.....-.............../........................../...................-...-.........................
...................|....|.........-..../....|.......|../|...../....\................../.............|.........
........./..\..-............................................\.....\......|...../\.\\..|..|/................\..
.....|\......|.............../............................/............................................../...-
...............|./../............/.\.\..............-./...................-./...|./...........................
-...|./.........../\...-...........................|....-.....................-......\..................-.....
....................|..|/............-./.....-\....|.............\./.............../.|.................\...|..
..\.|.-.\.................\...........-.........-..-.......................\.....|\......./.....-..........\..
.........|.........../............-...-...........-...-.......\.|....................-......./...|............
...|.......|.......................|...........\................\................\............../..\..........
/........../..-..............-................../..........\|..|..........-....\...........|-.................
.......\.............-..................-\......................\...................-..........-..........|...
../.....-\...............-.....\.............-....-\/..........|.-............/...............\.............\.
............/-........../.................\...../.........|.../....................\......|........-.........-
.......|....-...................../......../............................................/....-................
...\....-................................-....\.\.......................././............................./....
.......\...................../......\./.........|.......|.||....-.-.\..........-............................/.
..|..........\..-............|...........|..-......................\................/|....-...................
.-.........|...........-...|...../...|........../........|....................-.....-.........................
....................../.-...../............-......\...........-...\../...-|......./...........|......-||.-....
.........................................................-....-....../|........................../\..../......
.........|.......|....................................-.........../.-....................-....-..........\....
..|../-.|..........|.....|-......\..-....|/........\..|......./..\../...\....................././.|...........
.-..................-../...........\.....................-..|/..................../........\......./..-.-....|
.............................../...|...\|.........-........./|..........-......../.......-.....-........|.....
.................|-.......\........-......-/-../............\....................\......//.-.....\.........-..
............/...............-.../........|..-.........../-................\...-.........../.......\\...\\/....
........................-..\.............\......|........|/................../..........\.//..................
...............-.............\|-........../.|............./......................./..............|./..........
.......\/-.....\..|................../.....\.....|...................|......|...................-.\...........
............................................-...................................-...........-\......|.........
................./..../...|-\......./...............|.......................-..|........................../../
.........|...........|..................\...|........|../...|.......|............./..............|............
.......\........................\....../.......................-..............................................
|.-................\...|........|.\..................|..-.......|....-..|....|..................|.............
..............-|.-...............|.........................................................../................
........\....................|........../...........\.....|......|...................||.......................
.....................-...............................\...\.....-....\..................-...........\..........
..............|..\............../......-..................-....//..\|.|.\.......|.....................-.......
.\...|........||............................/................\....|..................\.......\..............-.
.............|...|.........../..|..............|.||../................|......|....................-....\......
.....................\.-...........\.|...|................|........-../..............|...|....................
....\.......\..............|.-\..................|........|../......./..-..../.........-.\...\................
.............|\......|/.....-....-......\......../............|....\....\...........................-.........
.........\..../................................-.................\\.....|...-..........-...........|......../.
..........-...................-..\...............-...\........|............\..../\...|...\..........|.........
||........\.................|......\|../...\..-...|../............................../.........................
..................\......................-|.....\.|..........|...||.........|..........\...|..................
............../..|.............-.....\............../........-.-......................-|.....-........|....../
..........................................///.....|...-..|.-...................\-...........\......\......./..
.....|.|.........................................................-.........................../|..|-...........
..../..../......-........|.......|.....\......-./...../.............|..............\....-......./|.\.\./...-\.
...\..........-..|...................|............................/.....\........\............................
........\..\...-................/..\...--...................................../\.......-....../......-.....\..
..-..................|...\......\..........-.|...\.................|..........\|...-..........................
\.............\-...\.............../...............\...\...................../.\.-..-\.-...|............./...\
../...|......../...........\..................\...................|.....\..|......\...../........-...../......
..../...........|.................../|...\.....-...-........|......../.............................|........|.
...................\................--..|..................../................................................
.\..\.............-/\.................................../...........|....\|......./.........................|.
............................./...................................-.............|............-/...|............
./.............................\......................-.........\..................-...-/.............-.......
...../..........|.....|...../.......................\.................\...........\...........................
........||....................-..-........|......../......./.-\............../............-...................
..........-..../...........|.-.............-...........................\.....|..|.-.....-...\...|.............
.../.....................\.........-..|......................./....\..\..................-....................
./.........../...............................................................-................................
..-....//................/.................../....-.\.....-....\....\..........|......................./......
..........................-......\....|...........\\|.........................-...\.....|...../........\......
........|...............-...\...................../........................../.-..........\../.......\........
........|.\.....|..\...||.............\............./............././.......\....\..................../.....|.
..................../.................-..\......../................-....|.......................|.............
...........|....\......./..|...............|........|............\.../................../..........\..........
......./...|........./...-.|\................................................./................./.............
...............|....\../..-/..............|.....................\....|...............\........../.....\.\.....
\|......||...../.../........................../......./.....\./...-.............../............|.......|....\.
.\./.....................|.........-.....-..../.\\..............................\.................-...........
...........-......../.....|.......\.........|..-.....|.......\............/...-...-.-.|.|..|-.............|...
....................\.....-./......./...................................-.........................|....|......
..\...............|................./............/.......\./.....\.........-./...-................|||...|.....
......|.....|...../....|......../.......\./........-..-...\.-..-.-.........................|........-\........
|-..................\.....-.............................|../\..........||............|.|................|.....
.................\..\.....|....................../.....-............./|...............................--.|..-|
..|.........-.-..........-./..................././................-...........................\......../......
.....|./-............|.......\/.....-...-........-......................\.......|.............\..|............
......|..............|............|./...........\..-......\..\.-..../..../.../................-|....|..\......</pre>

  <script>
    const parseInput = (rawInut) => {
      return rawInut.split('\n')
    }

    const data = parseInput(document.querySelector('pre').innerText)

    const handleMove = (input, beam, energizedCells, beams) => {
      const start = { x: beam.x, y: beam.y }
      const end = false
      let newBeams = []

      energizedCells[beam.y][beam.x] = '1'

      switch (input[beam.y][beam.x]) {
        case '|':
          if ('lr'.includes(beam.dir)) {
            beam.end = true
            newBeams.push({ x: beam.x, y: beam.y + 1, dir: 'b', start, end })
            newBeams.push({ x: beam.x, y: beam.y - 1, dir: 't', start, end })
          } else {
            beam.y += 't b'.indexOf(beam.dir) - 1
          }
          break
        case '-':
          if ('tb'.includes(beam.dir)) {
            beam.end = true
            newBeams.push({ x: beam.x - 1, y: beam.y, dir: 'l', start, end })
            newBeams.push({ x: beam.x + 1, y: beam.y, dir: 'r', start, end })
          } else {
            beam.x += 'l r'.indexOf(beam.dir) - 1
          }
          break
        case '/':
          beam.end = true
          switch (beam.dir) {
            case 't':
              newBeams.push({ x: beam.x + 1, y: beam.y, dir: 'r', start, end })
              break
            case 'r':
              newBeams.push({ x: beam.x, y: beam.y - 1, dir: 't', start, end })
              break
            case 'b':
              newBeams.push({ x: beam.x - 1, y: beam.y, dir: 'l', start, end })
              break
            case 'l':
              newBeams.push({ x: beam.x, y: beam.y + 1, dir: 'b', start, end })
              break

            default:
              break
          }
          break
        case '\\':
          beam.end = true
          switch (beam.dir) {
            case 't':
              newBeams.push({ x: beam.x - 1, y: beam.y, dir: 'l', start, end })
              break
            case 'l':
              newBeams.push({ x: beam.x, y: beam.y - 1, dir: 't', start, end })
              break
            case 'r':
              newBeams.push({ x: beam.x, y: beam.y + 1, dir: 'b', start, end })
              break
            case 'b':
              newBeams.push({ x: beam.x + 1, y: beam.y, dir: 'r', start, end })
              break

            default:
              break
          }
          break

        case '.':
          switch (beam.dir) {
            case 't':
              beam.y--
              break
            case 'r':
              beam.x++
              break
            case 'b':
              beam.y++
              break
            case 'l':
              beam.x--
              break

            default:
              break
          }
          break

        default:
          beam.end = true
          break
      }

      return [beam, energizedCells, newBeams]
    }

    const partOne = (input) => {
      const t1 = performance.now()
      const beamStart = { x: 0, y: 0, dir: 'r', start: { x: 0, y: 0 }, end: false }
      let energizedCells = Array.from(new Array(input.length), () => Array.from(new Array(input[0].length), () => ' '))
      let stack = [beamStart]
      let sum = 0

      for (let i = 0; i < stack.length; i++) {
        while (!stack[i].end) {
          if (
            stack.find(val => (
              val.end === true
              && stack[i].start.x === val.start.x
              && stack[i].start.y === val.start.y
              && stack[i].dir === val.dir))
            || stack[i].x < 0
            || stack[i].y < 0
            || stack[i].x >= input[0].length
            || stack[i].y >= input.length
          ) {
            stack[i].end = true
            break
          }

          let newBeams = [];

          [stack[i], energizedCells, newBeams] = handleMove(input, stack[i], energizedCells, stack)

          newBeams?.map((beam) => stack.push(beam))
        }
      }

      for (let i = 0; i < energizedCells.length; i++) {
        for (let j = 0; j < energizedCells[i].length; j++) {
          energizedCells[i][j] === '1' && sum++
        }
      }

      console.log('Time for solution one is ' + (performance.now() - t1).toFixed(2) + ' ms')
      console.log('Solution for part one is ' + sum + '!')
    }
    partOne(data)

    const partTwo = (input) => {
      const t1 = performance.now()
      let sum = 0

      console.log('Time for solution two is ' + (performance.now() - t1).toFixed(2) + ' ms')
      console.log('Solution for part two is ' + sum + '!')
    }
    partTwo(data)

  </script>
</body>

</html>