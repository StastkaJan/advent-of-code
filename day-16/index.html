<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="light dark">

  <title>Day 16 - Advent of code</title>
</head>

<body>
  <pre style="word-wrap: break-word; white-space: pre-wrap;">\....../...|..........|....../.../..-../.|...|......-.|..................................|.............../....
|....-.........\..........\......./.....................................|.....-...........||..................
.........-......|./...........\.../-......./.|...\.-.......................\....\.............................
...............//...............\.........................\.......................\....../........./.........\
..-........................-..........................................|............../..\.........../.........
..........\....\../...............|--....../..............-.............|...-.....\........\.........-...\-...
....|...|..|........................../..................-............./..\-........../|.........|...........|
.........-.....\...................-.............|.............../....-....-....|............../....\../-.....
.....\../\......../..|........................|.......-........................../-...|.......................
..............|/................|........|..-......|....|.|.......|.-....\.../.............|.....-.......-....
.-...|..................../..|......\......|./..-.....\../......................\.|..--...................../.
.............../..|...................-........./.................../....|.............-..........|.|..\../...
.|...........|-.........|/....\.....\...-...-.-.-......-...................................../.......\-.......
./................./.................\..................../.-..................|.....................\.....\..
\........-...|......|........-...................\.........................-..-........./....../.....\........
........-../..........|........................-..-/\...\........-.../.../...-......................./\.....-.
..//|\.........../\.......-...........\....\.....-./.|.............\...../..\.......||.......-................
........./....\.........\-................/................................|-...\/.........|......|...........
...|........\.../......\....../......\........./....|....../...../..|......../.-.........................\....
../......./....|................................................................................\\.......\..|.
.............-.\.|..........|....................................................-..........|.................
\......|.............\..-.....................................-.|...................................-|........
.....................-......|\......................|...-.\......-.........-.........\............//...-......
.../.....\..................|..-/....|.......\......\........./......./../............................\../....
....|....../.....-.............../........................../...................-...-.........................
...................|....|.........-..../....|.......|../|...../....\................../.............|.........
........./..\..-............................................\.....\......|...../\.\\..|..|/................\..
.....|\......|.............../............................/............................................../...-
...............|./../............/.\.\..............-./...................-./...|./...........................
-...|./.........../\...-...........................|....-.....................-......\..................-.....
....................|..|/............-./.....-\....|.............\./.............../.|.................\...|..
..\.|.-.\.................\...........-.........-..-.......................\.....|\......./.....-..........\..
.........|.........../............-...-...........-...-.......\.|....................-......./...|............
...|.......|.......................|...........\................\................\............../..\..........
/........../..-..............-................../..........\|..|..........-....\...........|-.................
.......\.............-..................-\......................\...................-..........-..........|...
../.....-\...............-.....\.............-....-\/..........|.-............/...............\.............\.
............/-........../.................\...../.........|.../....................\......|........-.........-
.......|....-...................../......../............................................/....-................
...\....-................................-....\.\.......................././............................./....
.......\...................../......\./.........|.......|.||....-.-.\..........-............................/.
..|..........\..-............|...........|..-......................\................/|....-...................
.-.........|...........-...|...../...|........../........|....................-.....-.........................
....................../.-...../............-......\...........-...\../...-|......./...........|......-||.-....
.........................................................-....-....../|........................../\..../......
.........|.......|....................................-.........../.-....................-....-..........\....
..|../-.|..........|.....|-......\..-....|/........\..|......./..\../...\....................././.|...........
.-..................-../...........\.....................-..|/..................../........\......./..-.-....|
.............................../...|...\|.........-........./|..........-......../.......-.....-........|.....
.................|-.......\........-......-/-../............\....................\......//.-.....\.........-..
............/...............-.../........|..-.........../-................\...-.........../.......\\...\\/....
........................-..\.............\......|........|/................../..........\.//..................
...............-.............\|-........../.|............./......................./..............|./..........
.......\/-.....\..|................../.....\.....|...................|......|...................-.\...........
............................................-...................................-...........-\......|.........
................./..../...|-\......./...............|.......................-..|........................../../
.........|...........|..................\...|........|../...|.......|............./..............|............
.......\........................\....../.......................-..............................................
|.-................\...|........|.\..................|..-.......|....-..|....|..................|.............
..............-|.-...............|.........................................................../................
........\....................|........../...........\.....|......|...................||.......................
.....................-...............................\...\.....-....\..................-...........\..........
..............|..\............../......-..................-....//..\|.|.\.......|.....................-.......
.\...|........||............................/................\....|..................\.......\..............-.
.............|...|.........../..|..............|.||../................|......|....................-....\......
.....................\.-...........\.|...|................|........-../..............|...|....................
....\.......\..............|.-\..................|........|../......./..-..../.........-.\...\................
.............|\......|/.....-....-......\......../............|....\....\...........................-.........
.........\..../................................-.................\\.....|...-..........-...........|......../.
..........-...................-..\...............-...\........|............\..../\...|...\..........|.........
||........\.................|......\|../...\..-...|../............................../.........................
..................\......................-|.....\.|..........|...||.........|..........\...|..................
............../..|.............-.....\............../........-.-......................-|.....-........|....../
..........................................///.....|...-..|.-...................\-...........\......\......./..
.....|.|.........................................................-.........................../|..|-...........
..../..../......-........|.......|.....\......-./...../.............|..............\....-......./|.\.\./...-\.
...\..........-..|...................|............................/.....\........\............................
........\..\...-................/..\...--...................................../\.......-....../......-.....\..
..-..................|...\......\..........-.|...\.................|..........\|...-..........................
\.............\-...\.............../...............\...\...................../.\.-..-\.-...|............./...\
../...|......../...........\..................\...................|.....\..|......\...../........-...../......
..../...........|.................../|...\.....-...-........|......../.............................|........|.
...................\................--..|..................../................................................
.\..\.............-/\.................................../...........|....\|......./.........................|.
............................./...................................-.............|............-/...|............
./.............................\......................-.........\..................-...-/.............-.......
...../..........|.....|...../.......................\.................\...........\...........................
........||....................-..-........|......../......./.-\............../............-...................
..........-..../...........|.-.............-...........................\.....|..|.-.....-...\...|.............
.../.....................\.........-..|......................./....\..\..................-....................
./.........../...............................................................-................................
..-....//................/.................../....-.\.....-....\....\..........|......................./......
..........................-......\....|...........\\|.........................-...\.....|...../........\......
........|...............-...\...................../........................../.-..........\../.......\........
........|.\.....|..\...||.............\............./............././.......\....\..................../.....|.
..................../.................-..\......../................-....|.......................|.............
...........|....\......./..|...............|........|............\.../................../..........\..........
......./...|........./...-.|\................................................./................./.............
...............|....\../..-/..............|.....................\....|...............\........../.....\.\.....
\|......||...../.../........................../......./.....\./...-.............../............|.......|....\.
.\./.....................|.........-.....-..../.\\..............................\.................-...........
...........-......../.....|.......\.........|..-.....|.......\............/...-...-.-.|.|..|-.............|...
....................\.....-./......./...................................-.........................|....|......
..\...............|................./............/.......\./.....\.........-./...-................|||...|.....
......|.....|...../....|......../.......\./........-..-...\.-..-.-.........................|........-\........
|-..................\.....-.............................|../\..........||............|.|................|.....
.................\..\.....|....................../.....-............./|...............................--.|..-|
..|.........-.-..........-./..................././................-...........................\......../......
.....|./-............|.......\/.....-...-........-......................\.......|.............\..|............
......|..............|............|./...........\..-......\..\.-..../..../.../................-|....|..\......</pre>

  <script>
    const parseInput = (rawInut) => {
      return rawInut.split('\n')
    }

    const data = parseInput(document.querySelector('pre').innerText)

    const handleMove = (input, beam, energizedCells, beams) => {
      const start = { x: beam.x, y: beam.y }
      const end = false
      let newBeams = []

      energizedCells[beam.y][beam.x] = '1'

      switch (input[beam.y][beam.x]) {
        case '|':
          if ('lr'.includes(beam.dir)) {
            beam.end = true
            newBeams.push({ x: beam.x, y: beam.y + 1, dir: 'b', start, end })
            newBeams.push({ x: beam.x, y: beam.y - 1, dir: 't', start, end })
          } else {
            beam.y += 't b'.indexOf(beam.dir) - 1
          }
          break
        case '-':
          if ('tb'.includes(beam.dir)) {
            beam.end = true
            newBeams.push({ x: beam.x - 1, y: beam.y, dir: 'l', start, end })
            newBeams.push({ x: beam.x + 1, y: beam.y, dir: 'r', start, end })
          } else {
            beam.x += 'l r'.indexOf(beam.dir) - 1
          }
          break
        case '/':
          beam.end = true
          switch (beam.dir) {
            case 't':
              newBeams.push({ x: beam.x + 1, y: beam.y, dir: 'r', start, end })
              break
            case 'r':
              newBeams.push({ x: beam.x, y: beam.y - 1, dir: 't', start, end })
              break
            case 'b':
              newBeams.push({ x: beam.x - 1, y: beam.y, dir: 'l', start, end })
              break
            case 'l':
              newBeams.push({ x: beam.x, y: beam.y + 1, dir: 'b', start, end })
              break

            default:
              break
          }
          break
        case '\\':
          beam.end = true
          switch (beam.dir) {
            case 't':
              newBeams.push({ x: beam.x - 1, y: beam.y, dir: 'l', start, end })
              break
            case 'l':
              newBeams.push({ x: beam.x, y: beam.y - 1, dir: 't', start, end })
              break
            case 'r':
              newBeams.push({ x: beam.x, y: beam.y + 1, dir: 'b', start, end })
              break
            case 'b':
              newBeams.push({ x: beam.x + 1, y: beam.y, dir: 'r', start, end })
              break

            default:
              break
          }
          break

        case '.':
          switch (beam.dir) {
            case 't':
              beam.y--
              break
            case 'r':
              beam.x++
              break
            case 'b':
              beam.y++
              break
            case 'l':
              beam.x--
              break

            default:
              break
          }
          break

        default:
          beam.end = true
          break
      }

      return [beam, energizedCells, newBeams]
    }

    const partOne = (input) => {
      const t1 = performance.now()
      const beamStart = { x: 0, y: 0, dir: 'r', start: { x: 0, y: 0 }, end: false }
      let energizedCells = Array.from(new Array(input.length), () => Array.from(new Array(input[0].length), () => ' '))
      let stack = [beamStart]
      let sum = 0

      for (let i = 0; i < stack.length; i++) {
        while (!stack[i].end) {
          if (
            stack.find(val => (
              val.end === true
              && stack[i].start.x === val.start.x
              && stack[i].start.y === val.start.y
              && stack[i].dir === val.dir))
            || stack[i].x < 0
            || stack[i].y < 0
            || stack[i].x >= input[0].length
            || stack[i].y >= input.length
          ) {
            stack[i].end = true
            break
          }

          let newBeams = [];

          [stack[i], energizedCells, newBeams] = handleMove(input, stack[i], energizedCells, stack)

          newBeams?.map((beam) => stack.push(beam))
        }
      }

      for (let i = 0; i < energizedCells.length; i++) {
        for (let j = 0; j < energizedCells[i].length; j++) {
          energizedCells[i][j] === '1' && sum++
        }
      }

      console.log('Time for solution one is ' + (performance.now() - t1).toFixed(2) + ' ms')
      console.log('Solution for part one is ' + sum + '!')
    }
    partOne(data)

    const partTwo = (input) => {
      const t1 = performance.now()
      const beamsStarts = []
      let sum = 0

      for (let i = 0; i < input.length; i++) {
        beamsStarts.push({ x: 0, y: i, dir: 'r', start: { x: 0, y: i }, end: false })

        for (let j = 0; j < input[0].length; j++) {
          (i === 0) && beamsStarts.push({ x: j, y: i, dir: 'b', start: { x: j, y: i }, end: false });
          (i === input.length - 1) && beamsStarts.push({ x: j, y: i, dir: 't', start: { x: j, y: i }, end: false })
        }

        beamsStarts.push({ x: input.length - 1, y: i, dir: 'l', start: { x: input.length - 1, y: i }, end: false })
      }

      for (let i = 0; i < beamsStarts.length; i++) {
        let energizedCells = Array.from(new Array(input.length), () => Array.from(new Array(input[0].length), () => ' '))
        let stack = [beamsStarts[i]]
        let count = 0

        for (let j = 0; j < stack.length; j++) {
          while (!stack[j].end) {
            if (
              stack.find(val => (
                val.end === true
                && stack[j].start.x === val.start.x
                && stack[j].start.y === val.start.y
                && stack[j].dir === val.dir))
              || stack[j].x < 0
              || stack[j].y < 0
              || stack[j].x >= input[0].length
              || stack[j].y >= input.length
            ) {
              stack[j].end = true
              break
            }

            let newBeams = [];

            [stack[j], energizedCells, newBeams] = handleMove(input, stack[j], energizedCells, stack)

            newBeams?.map((beam) => stack.push(beam))
          }
        }

        for (let j = 0; j < energizedCells.length; j++) {
          for (let k = 0; k < energizedCells[j].length; k++) {
            energizedCells[j][k] === '1' && count++
          }
        }

        count > sum && (sum = count)
      }

      console.log('Time for solution two is ' + (performance.now() - t1).toFixed(2) + ' ms')
      console.log('Solution for part two is ' + sum + '!')
    }
    partTwo(data)

  </script>
</body>

</html>