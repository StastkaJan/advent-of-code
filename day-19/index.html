<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="light dark">

  <title>Day 19 - Advent of code</title>
</head>

<body>
  <pre style="word-wrap: break-word; white-space: pre-wrap;">px{a&lt;2006:qkq,m&gt;2090:A,rfg}
pv{a&gt;1716:R,A}
lnx{m&gt;1548:A,A}
rfg{s&lt;537:gd,x&gt;2440:R,A}
qs{s&gt;3448:A,lnx}
qkq{x&lt;1416:A,crn}
crn{x&gt;2662:A,R}
in{s&lt;1351:px,qqz}
qqz{s&gt;2770:qs,m&lt;1801:hdj,R}
gd{a&gt;3333:R,R}
hdj{m&gt;838:A,pv}

{x=787,m=2655,a=1222,s=2876}
{x=1679,m=44,a=2067,s=496}
{x=2036,m=264,a=79,s=2244}
{x=2461,m=1339,a=466,s=291}
{x=2127,m=1623,a=2188,s=1013}</pre>

  <script>
    const parseInput = () => {
      return document.querySelector('pre').innerText.split('\n\n').map((val) => val.split('\n'))
    }

    const data = parseInput()

    const parseConditions = (conditions) => {
      const functionName = new RegExp(/^[a-z]+/)
      const returnFunctionNames = new RegExp(/[a-z]{2,}|A|R/g)
      const map = {}

      const parsedValues = conditions.map((val) => {
        const retVal = val.match(functionName)[0]
        map[retVal] = new Function('return '
          + val
            .replaceAll(':', ' ? ')
            .replaceAll(',', ' : ')
            .replace('}', '')
            .replace('{', '({x, m, a, s}) => ')
            .replace(functionName, '')
            .replace(returnFunctionNames, (match) => `"${match}"`)
        )()
        return retVal
      })

      return map
    }

    const parseValues = (values) => {
      const regexp = new RegExp(/[a-z]/g)
      const parsedValues = values.map((val) => JSON.parse(val.replaceAll('=', ':').replace(regexp, (match) => `"${match}"`)))
      return parsedValues
    }

    const checkConditions = (condition, value) => {
      let precessedCondition = condition.replace(/[a-z]/, (match) => value[match])
      return new Function('return ' + precessedCondition)()
    }

    const processInputValues = (conditions, values) => {
      let sum = 0

      for (let i = 0; i < values.length; i++) {
        let condition = 'in'

        while (!'AR'.includes(condition)) {
          condition = conditions[condition](values[i])
        }

        if (condition === 'A') {
          sum += Object.values(values[i]).reduce((prev, curr) => prev + curr)
        }
      }

      return sum
    }

    const partOne = (input) => {
      const t1 = performance.now()
      let sum = 0

      const [conditions, values] = [parseConditions(input[0]), parseValues(input[1])]

      sum = processInputValues(conditions, values)

      console.log('Time for solution one is ' + (performance.now() - t1).toFixed(2) + ' ms')
      console.log('Solution for part one is ' + sum + '!')
    }
    partOne(data)

    const partTwo = (input) => {
      const t1 = performance.now()
      let sum = 0

      console.log(input)

      console.log('Time for solution two is ' + (performance.now() - t1).toFixed(2) + ' ms')
      console.log('Solution for part two is ' + sum + '!')
    }
    partTwo(data[0])
  </script>
</body>

</html>